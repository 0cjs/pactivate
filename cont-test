#!/usr/bin/env bash
#
#   cont-test - run within a container to test pactivate
#
set -eu -o pipefail

fail() { echo FAILURE: "$@"; exit 1; }

cd /test/

echo '----- error when run with /bin/sh'
/bin/sh   ./pactivate 2>err-sh   && fail "didn't fail when run with /bin/sh"
grep -q 'source.*with Bash' err-sh || { cat err-sh; fail "bad message"; }

echo '----- error when run with /bin/bash'
/bin/bash ./pactivate 2>err-bash && fail "didn't fail when run with /bin/bash"
grep -q 'source.*with Bash' err-bash || { cat err-bash; fail "bad message"; }

echo '----- run pactivate'
. ./pactivate

fail "XXX write remaining tests...."
